<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>SchuelerVerwaltung</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="css/bootstrap.css" rel="stylesheet">
    <style type="text/css">
        body {
            padding-top: 20px;
            padding-bottom: 40px;
        }

            /* Custom container */
        .container-narrow {
            margin: 0 auto;
            max-width: 700px;
        }

        .container-narrow > hr {
            margin: 30px 0;
        }

            /* Main marketing message and sign up button */
        .jumbotron {
            margin: 60px 0;
            text-align: center;
        }

        h1 {
            margin-bottom: 30px;
        }

        .jumbotron h1 {
            font-size: 72px;
            line-height: 1;
            /*margin-bottom: 30px;*/
        }

        .jumbotron .btn {
            font-size: 21px;
            padding: 14px 24px;
        }

            /*#benutzerliste a:hover {*/
            /*}*/

    </style>
    <link href="css/bootstrap-responsive.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
    <script src="js/html5shiv.js"></script>
    <![endif]-->
</head>

<body>

<div class="container-narrow">

    <div class="masthead">
        <h3 class="muted">Sch&uuml;lerverwaltung</h3>
    </div>

    <hr/>

    <!-- Kerngruppenübersicht -->
    <div id="ubersicht" style="display: none;">
        <h1>Kerngruppe ausw&auml;hlen</h1>
        <table class="table table-striped">
            <tr>
                <td><a class="btn btn-small" href="#editgroup-kg7_1">7.1</a></td>
                <td><a class="btn btn-small" href="#editgroup-kg7_2">7.2</a></td>
                <td><a class="btn btn-small" href="#editgroup-kg7_3">7.3</a></td>
                <td><a class="btn btn-small" href="#editgroup-kg7_4">7.4</a></td>
                <td><a class="btn btn-small" href="#editgroup-kg7_5">7.5</a></td>
                <td><a class="btn btn-small" href="#editgroup-kg7_6">7.6</a></td>
            </tr>

            <tr>
                <td><a class="btn btn-small" href="#editgroup-kg8_1">8.1</a></td>
                <td><a class="btn btn-small" href="#editgroup-kg8_2">8.2</a></td>
                <td><a class="btn btn-small" href="#editgroup-kg8_3">8.3</a></td>
                <td><a class="btn btn-small" href="#editgroup-kg8_4">8.4</a></td>
                <td><a class="btn btn-small" href="#editgroup-kg8_5">8.5</a></td>
                <td><a class="btn btn-small" href="#editgroup-kg8_6">8.6</a></td>
            </tr>

            <tr>
                <td><a class="btn btn-small" href="#editgroup-kg9_1">9.1</a></td>
                <td><a class="btn btn-small" href="#editgroup-kg9_2">9.2</a></td>
                <td><a class="btn btn-small" href="#editgroup-kg9_3">9.3</a></td>
                <td><a class="btn btn-small" href="#editgroup-kg9_4">9.4</a></td>
                <td><a class="btn btn-small" href="#editgroup-kg9_5">9.5</a></td>
                <td><a class="btn btn-small" href="#editgroup-kg9_6">9.6</a></td>
            </tr>

            <tr>
                <td><a class="btn btn-small" href="#editgroup-kg10_1">10.1</a></td>
                <td><a class="btn btn-small" href="#editgroup-kg10_2">10.2</a></td>
                <td><a class="btn btn-small" href="#editgroup-kg10_3">10.3</a></td>
                <td><a class="btn btn-small" href="#editgroup-kg10_4">10.4</a></td>
                <td><a class="btn btn-small" href="#editgroup-kg10_5">10.5</a></td>
                <td><a class="btn btn-small" href="#editgroup-kg10_6">10.6</a></td>
            </tr>
        </table>

    </div>

    <!-- einzelne Kerngruppe auflisten -->
    <div id="kg" style="display: none">
        <h1>Kerngruppe <span id="kgname">#</span> bearbeiten</h1>

        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span6">
                    <table class="table table-striped table-hover" id="benutzerliste">
                    </table>
                </div>

                <div class="span5 offset1">
                    <a href="#userAnlegen"
                       id="userAnlegenInUbersichtButton"
                       role="button"
                       class="btn btn-success">
                        neues Sch&uuml;lerkonto anlegen
                    </a>
                    <br>
                    <br>
                    <a href="#" class="btn">zur&uuml;ck zur &Uuml;bersicht</a>
                </div>

            </div>
        </div>

    </div>

    <!-- Schülerkonto anlegen / bearbeiten -->
    <div id="userAnlegen">
        <h1 id="userAnlegenHeader">Sch&uuml;lerkonto <span id="userAnlegenBearbeitenLabel"></span></h1>

        <h3>f&uuml;r Kerngruppe <span id="userAnlegenGruppeLabel"></span></h3>

        <form class="form-horizontal">
            <div class="control-group">
                <label class="control-label" for="givenname">Vollst&auml;ndiger Name</label>

                <div class="controls">
                    <input type="text" id="givenname" placeholder="Vollst&auml;ndiger Name">
                </div>
            </div>

            <div class="control-group">
                <label class="control-label" for="username">Benutzername</label>

                <div class="controls">
                    <input type="text" id="username" placeholder="Benutzername">
                </div>
            </div>

            <div class="control-group">
                <label class="control-label" for="inputPassword">Password</label>

                <div class="controls">
                    <input type="password" id="inputPassword" placeholder="Password">
                </div>

                <label class="control-label" for="inputPasswordWiederholt">Password wiederholen</label>

                <div class="controls">
                    <input type="password" id="inputPasswordWiederholt" placeholder="Password">
                </div>
            </div>

            <a href="#" id="userAnlegenSpeichern" class="btn btn-primary">Konto anlegen</a>
            <a href="#" id="userAnlegenSchliessen" class="btn">Close</a>
        </form>
    </div>

    <hr>
    <div class="footer">
        <p>&copy; Helmholtz-Schule / Jonas Hoge / Alexander Bl&uuml;m 2013</p>
        <a href="http://stackoverflow.com/questions/1051061/convert-json-array-to-an-html-table-in-jquery">
            convert-json-array-to-an-html-table-in-jquery
        </a>
    </div>

</div>
<!-- /container -->

<!-- Le javascript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="js/jquery-1.9.1.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/jquery.ba-hashchange.min.js"></script>

<script type="text/javascript">

    // cache for user data needs update
    var cache = new Object();
    cache.isDirty = true;
    cache.postFetch = function () {
    };
    cache.data = 10;
    cache.update = function () {
        console.log("cache.update()");
        if (cache.isDirty == true) {
            $.get("alleSchueler.json", function (data) {
                console.log("cache updated");
                cache.data = data;
                cache.postFetch();
                cache.postFetch = function () {
                };
                cache.isDirty = false;
            });
        } else {
            cache.postFetch();
        }
    }

    $("#userAnlegenSpeichern").bind("click", function () {
                console.log(">>> userAnlegenSpeichern clicked");
                function uberprufeSchulerAddForm() { }

                uberprufeSchulerAddForm();
                cache.isDirty = true;
                cache.update();
            }
    );


    function createUserList(kerngruppe) {
        var tbl_body = "";
        $.each(cache.data, function () {
            $.each(this, function (k, v) {
                var tbl_row = "";
                un = v.username;
                gn = v.givenname;
                tbl_row += "<td><a class=\"nav-pills\" href=\"#userBearbeiten-"
                        + kerngruppe + "-" + k + "\">"
                        + "<i class=\"icon-user\"></i> " + un + "</a></td>";
                tbl_row += "<td>" + gn + "</td>";

                tbl_body += "<tr>" + tbl_row + "</tr>";
            })
        })
        $("#benutzerliste").html(tbl_body);
    }

    function changeContents() {
        var UBERSICHT = "#ubersicht"
        var KG = "#kg"
        var USERANLEGEN = "#userAnlegen";
        var USERANLEGENBEARBEITEN = "#userAnlegenBearbeitenLabel";
        var USERANLEGENGRUPPE = "#userAnlegenGruppeLabel";

        $(UBERSICHT).hide();
        $(KG).hide();
        $(USERANLEGEN).hide();

        var locationHash = location.hash;
        var activity = locationHash.substr(1).split("-");

        var gruppenName = function (name) {
            console.log("input = " + name);
            var group;
            if (name.substring(0, 2) == "kg") {
                group = name.substr(2).replace("_", ".");
            } else {
                group = name;
            }
            console.log("gruppenName = " + group);
            return group;
        }


        console.log("activity = " + activity)
        switch (activity[0]) {
            default:
                $(UBERSICHT).show();
                break;

            case "userAnlegen":
                $(USERANLEGEN).show();
                $(USERANLEGENBEARBEITEN).html("anlegen");
                $(USERANLEGENGRUPPE).html(gruppenName(activity[1]));
                $(USERANLEGENGRUPPE).parent().show();
                $("#givenname").val("");
                $("#username").val("");
                cache.isDirty = true;
                break;

            case "userBearbeiten":
                $(USERANLEGEN).show();
                $(USERANLEGENBEARBEITEN).html("bearbeiten");
                $(USERANLEGENGRUPPE).parent().hide();
                $("#givenname").val(cache.data.schueler[activity[2]].givenname);
                $("#username").val(cache.data.schueler[activity[2]].username);
                break;

            case "editgroup":
                cache.postFetch = function () {
                    createUserList(activity[1]);
                };

                $("#userAnlegenInUbersichtButton").attr("href", USERANLEGEN + "-" + activity[1]);
                $("#userAnlegenSchliessen").attr("href", locationHash);
                $("#userAnlegenSpeichern").attr("href", locationHash);
                $("#kgname").html(gruppenName(activity[1]));
                $(KG).show()
                break;
        }

        cache.update();
    }

    $(document).ready(function () {
        changeContents();
    });

    $(window).hashchange(function () {
        changeContents();
    });

</script>

</body>

</html>

